{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
      "networkInterfaces_centralised_logs_vm815_z1_name": {
        "type": "string",
        "defaultValue": "mynic"
      },
      "publicIPAddresses_centralised_logs_vm_ip_name": {
        "type": "string",
        "defaultValue": "myip"
      },
      "networkSecurityGroups_centralised_logs_vm_nsg_name": {
        "type": "string",
        "defaultValue": "mynsg"
      },
      "virtualNetworks_dev_propel_vnet_name": {
        "type": "string",
        "defaultValue": "myvnet"
      },
      "networkSecurityGroups_dev_propel_appservice_nsg_name": {
        "type": "string",
        "defaultValue": "tempnsg"
      }
    },
    "resources": [
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/publicIPAddresses', parameters('publicIPAddresses_centralised_logs_vm_ip_name'))]",
          "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'storage-subnet')]",
          "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_centralised_logs_vm_nsg_name'))]"
        ],
        "kind": "Regular",
        "location": "eastus",
        "name": "[parameters('networkInterfaces_centralised_logs_vm815_z1_name')]",
        "properties": {
          "auxiliaryMode": "None",
          "auxiliarySku": "None",
          "disableTcpStateTracking": false,
          "dnsSettings": {
            "dnsServers": []
          },
          "enableAcceleratedNetworking": false,
          "enableIPForwarding": false,
          "ipConfigurations": [
            {
              "id": "[concat(resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaces_centralised_logs_vm815_z1_name')), '/ipConfigurations/ipconfig1')]",
              "name": "ipconfig1",
              "properties": {
                "primary": true,
                "privateIPAddress": "10.1.5.5",
                "privateIPAddressVersion": "IPv4",
                "privateIPAllocationMethod": "Dynamic",
                "publicIPAddress": {
                  "id": "[resourceId('Microsoft.Network/publicIPAddresses', parameters('publicIPAddresses_centralised_logs_vm_ip_name'))]",
                  "properties": {
                    "deleteOption": "Detach"
                  }
                },
                "subnet": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'storage-subnet')]"
                }
              },
              "type": "Microsoft.Network/networkInterfaces/ipConfigurations"
            }
          ],
          "networkSecurityGroup": {
            "id": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_centralised_logs_vm_nsg_name'))]"
          },
          "nicType": "Standard"
        },
        "tags": {
          "Business Unit": "einfochips"
        },
        "type": "Microsoft.Network/networkInterfaces"
      },
  ///////// VNET
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_dev_propel_appservice_nsg_name'))]"
        ],
        "location": "eastus",
        "name": "[parameters('virtualNetworks_dev_propel_vnet_name')]",
        "properties": {
          "addressSpace": {
            "addressPrefixes": [
              "10.1.0.0/16"
            ]
          },
          "dhcpOptions": {
            "dnsServers": []
          },
          "enableDdosProtection": false,
          "privateEndpointVNetPolicies": "Disabled",
          "subnets": [
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'storage-subnet')]",
              "name": "storage-subnet",
              "properties": {
                "addressPrefix": "10.1.5.0/24",
                "defaultOutboundAccess": true,
                "delegations": [],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": []
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'cosmos-subnet')]",
              "name": "cosmos-subnet",
              "properties": {
                "addressPrefix": "10.1.6.0/24",
                "defaultOutboundAccess": true,
                "delegations": [],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": []
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'redis-subnet')]",
              "name": "redis-subnet",
              "properties": {
                "addressPrefix": "10.1.4.0/24",
                "defaultOutboundAccess": true,
                "delegations": [],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": []
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'sqlserver-subnet')]",
              "name": "sqlserver-subnet",
              "properties": {
                "addressPrefix": "10.1.8.0/24",
                "defaultOutboundAccess": true,
                "delegations": [],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": []
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'adx-subnet')]",
              "name": "adx-subnet",
              "properties": {
                "addressPrefix": "10.1.9.0/24",
                "defaultOutboundAccess": true,
                "delegations": [],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": []
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'flex-function-subnet')]",
              "name": "flex-function-subnet",
              "properties": {
                "addressPrefix": "10.1.10.0/24",
                "defaultOutboundAccess": true,
                "delegations": [
                  {
                    "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'flex-function-subnet'), '/delegations/appservice-delegation')]",
                    "name": "appservice-delegation",
                    "properties": {
                      "serviceName": "Microsoft.App/environments"
                    },
                    "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                  }
                ],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": [
                  {
                    "locations": [
                      "*"
                    ],
                    "service": "Microsoft.AzureCosmosDB"
                  },
                  {
                    "locations": [
                      "eastus",
                      "westus",
                      "westus3"
                    ],
                    "service": "Microsoft.Storage"
                  },
                  {
                    "locations": [
                      "eastus"
                    ],
                    "service": "Microsoft.Sql"
                  }
                ]
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'streamanalytics-subnet')]",
              "name": "streamanalytics-subnet",
              "properties": {
                "addressPrefix": "10.1.3.0/24",
                "defaultOutboundAccess": false,
                "delegations": [
                  {
                    "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'streamanalytics-subnet'), '/delegations/streamanalytics-delegation')]",
                    "name": "streamanalytics-delegation",
                    "properties": {
                      "serviceName": "Microsoft.StreamAnalytics/streamingJobs"
                    },
                    "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                  }
                ],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": [
                  {
                    "locations": [
                      "*"
                    ],
                    "service": "Microsoft.AzureCosmosDB"
                  },
                  {
                    "locations": [
                      "eastus",
                      "westus",
                      "westus3"
                    ],
                    "service": "Microsoft.Storage"
                  }
                ]
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'appservice-subnet')]",
              "name": "appservice-subnet",
              "properties": {
                "addressPrefix": "10.1.1.0/24",
                "defaultOutboundAccess": true,
                "delegations": [
                  {
                    "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'appservice-subnet'), '/delegations/appservice-delegation')]",
                    "name": "appservice-delegation",
                    "properties": {
                      "serviceName": "Microsoft.Web/serverFarms"
                    },
                    "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                  }
                ],
                "networkSecurityGroup": {
                  "id": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_dev_propel_appservice_nsg_name'))]"
                },
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled",
                "serviceEndpoints": [
                  {
                    "locations": [
                      "*"
                    ],
                    "service": "Microsoft.AzureCosmosDB"
                  },
                  {
                    "locations": [
                      "eastus",
                      "westus",
                      "westus3"
                    ],
                    "service": "Microsoft.Storage"
                  },
                  {
                    "locations": [
                      "eastus"
                    ],
                    "service": "Microsoft.Sql"
                  }
                ]
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            },
            {
              "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'function-subnet')]",
              "name": "function-subnet",
              "properties": {
                "addressPrefix": "10.1.2.0/24",
                "defaultOutboundAccess": true,
                "delegations": [
                  {
                    "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'function-subnet'), '/delegations/appservice-delegation')]",
                    "name": "appservice-delegation",
                    "properties": {
                      "serviceName": "Microsoft.Web/serverFarms"
                    },
                    "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                  }
                ],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets"
            }
          ],
          "virtualNetworkPeerings": []
        },
        "tags": {
          "Administrator": "Alpesh Bhavsar",
          "Application": "Propel-DevOps",
          "Application Owner": "Yash Badiani",
          "Business Owner": "Sweta Parekh",
          "Business Unit": "einfochips",
          "Environment": "dev",
          "Project Name": "Propel",
          "Sub Business Unit": "Propel"
        },
        "type": "Microsoft.Network/virtualNetworks"
      },
///////// Subnet
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/adx-subnet')]",
        "properties": {
          "addressPrefix": "10.1.9.0/24",
          "defaultOutboundAccess": true,
          "delegations": [],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": []
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/cosmos-subnet')]",
        "properties": {
          "addressPrefix": "10.1.6.0/24",
          "defaultOutboundAccess": true,
          "delegations": [],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": []
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/flex-function-subnet')]",
        "properties": {
          "addressPrefix": "10.1.10.0/24",
          "defaultOutboundAccess": true,
          "delegations": [
            {
              "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'flex-function-subnet'), '/delegations/appservice-delegation')]",
              "name": "appservice-delegation",
              "properties": {
                "serviceName": "Microsoft.App/environments"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
            }
          ],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": [
            {
              "locations": [
                "*"
              ],
              "service": "Microsoft.AzureCosmosDB"
            },
            {
              "locations": [
                "eastus",
                "westus",
                "westus3"
              ],
              "service": "Microsoft.Storage"
            },
            {
              "locations": [
                "eastus"
              ],
              "service": "Microsoft.Sql"
            }
          ]
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/function-subnet')]",
        "properties": {
          "addressPrefix": "10.1.2.0/24",
          "defaultOutboundAccess": true,
          "delegations": [
            {
              "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'function-subnet'), '/delegations/appservice-delegation')]",
              "name": "appservice-delegation",
              "properties": {
                "serviceName": "Microsoft.Web/serverFarms"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
            }
          ],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled"
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/redis-subnet')]",
        "properties": {
          "addressPrefix": "10.1.4.0/24",
          "defaultOutboundAccess": true,
          "delegations": [],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": []
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/sqlserver-subnet')]",
        "properties": {
          "addressPrefix": "10.1.8.0/24",
          "defaultOutboundAccess": true,
          "delegations": [],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": []
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/storage-subnet')]",
        "properties": {
          "addressPrefix": "10.1.5.0/24",
          "defaultOutboundAccess": true,
          "delegations": [],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": []
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/streamanalytics-subnet')]",
        "properties": {
          "addressPrefix": "10.1.3.0/24",
          "defaultOutboundAccess": false,
          "delegations": [
            {
              "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'streamanalytics-subnet'), '/delegations/streamanalytics-delegation')]",
              "name": "streamanalytics-delegation",
              "properties": {
                "serviceName": "Microsoft.StreamAnalytics/streamingJobs"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
            }
          ],
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": [
            {
              "locations": [
                "*"
              ],
              "service": "Microsoft.AzureCosmosDB"
            },
            {
              "locations": [
                "eastus",
                "westus",
                "westus3"
              ],
              "service": "Microsoft.Storage"
            }
          ]
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
      {
        "apiVersion": "2024-05-01",
        "dependsOn": [
          "[resourceId('Microsoft.Network/virtualNetworks', parameters('virtualNetworks_dev_propel_vnet_name'))]",
          "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_dev_propel_appservice_nsg_name'))]"
        ],
        "name": "[concat(parameters('virtualNetworks_dev_propel_vnet_name'), '/appservice-subnet')]",
        "properties": {
          "addressPrefix": "10.1.1.0/24",
          "defaultOutboundAccess": true,
          "delegations": [
            {
              "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_dev_propel_vnet_name'), 'appservice-subnet'), '/delegations/appservice-delegation')]",
              "name": "appservice-delegation",
              "properties": {
                "serviceName": "Microsoft.Web/serverFarms"
              },
              "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
            }
          ],
          "networkSecurityGroup": {
            "id": "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('networkSecurityGroups_dev_propel_appservice_nsg_name'))]"
          },
          "privateEndpointNetworkPolicies": "Disabled",
          "privateLinkServiceNetworkPolicies": "Enabled",
          "serviceEndpoints": [
            {
              "locations": [
                "*"
              ],
              "service": "Microsoft.AzureCosmosDB"
            },
            {
              "locations": [
                "eastus",
                "westus",
                "westus3"
              ],
              "service": "Microsoft.Storage"
            },
            {
              "locations": [
                "eastus"
              ],
              "service": "Microsoft.Sql"
            }
          ]
        },
        "type": "Microsoft.Network/virtualNetworks/subnets"
      },
  ///////// NSG
      {
        "apiVersion": "2024-05-01",
        "location": "eastus",
        "name": "[parameters('networkSecurityGroups_centralised_logs_vm_nsg_name')]",
        "properties": {
          "securityRules": [
            {
              "id": "[resourceId('Microsoft.Network/networkSecurityGroups/securityRules', parameters('networkSecurityGroups_centralised_logs_vm_nsg_name'), 'Allowssh')]",
              "name": "Allowssh",
              "properties": {
                "access": "Allow",
                "destinationAddressPrefix": "*",
                "destinationAddressPrefixes": [],
                "destinationPortRanges": [
                  "22",
                  "3000",
                  "3100",
                  "9090",
                  "12345",
                  "9009",
                  "9276",
                  "80",
                  "8000",
                  "443",
                  "9115",
                  "9100",
                  "9200"
                ],
                "direction": "Inbound",
                "priority": 100,
                "protocol": "*",
                "sourceAddressPrefixes": [
                  "182.76.141.104/29",
                  "115.112.142.32/29",
                  "14.97.73.248/29",
                  "116.199.207.100/32",
                  "172.178.81.135"
                ],
                "sourcePortRange": "*",
                "sourcePortRanges": []
              },
              "type": "Microsoft.Network/networkSecurityGroups/securityRules"
            }
          ]
        },
        "tags": {
          "Business Unit": "einfochips"
        },
        "type": "Microsoft.Network/networkSecurityGroups"
      }
    ]
  }
  